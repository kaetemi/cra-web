//! Derived color space constants.
//!
//! THIS FILE IS AUTO-GENERATED by gen_colorspace_derived.
//! Do not edit manually. Regenerate with:
//!   cargo run --manifest-path tools/gen_colorspace_derived/Cargo.toml > src/colorspace_derived.rs
//!
//! All constants are computed from primary constants at f64 precision.

// =============================================================================
// D65 ILLUMINANT VARIANTS
// =============================================================================

/// D65 CIE - authoritative definition from CIE 15:2004.
/// Derived from xy chromaticity (0.31272, 0.32903).
pub mod d65_cie {
    pub const X: f64 = 0.31272;
    pub const Y: f64 = 0.32903;
    pub const XYZ_X: f64 = 0.95043005197094488;
    pub const XYZ_Y: f64 = 1.0;
    pub const XYZ_Z: f64 = 1.08880649180925748;
}

/// D65 sRGB - derived from the canonical sRGB matrix row sums.
/// This is the operative white point for sRGB workflows.
pub mod d65_srgb {
    pub const X: f64 = 0.31271590722158249;
    pub const Y: f64 = 0.32900148050666228;
    pub const XYZ_X: f64 = 0.9505;
    pub const XYZ_Y: f64 = 1.0;
    pub const XYZ_Z: f64 = 1.089;
}

/// D65 4-digit - rounded values from ITU-R BT.709 / Adobe RGB specs.
/// Derived from xy chromaticity (0.3127, 0.3290).
pub mod d65 {
    pub const X: f64 = 0.3127;
    pub const Y: f64 = 0.329;
    pub const XYZ_X: f64 = 0.95045592705167159;
    pub const XYZ_Y: f64 = 1.0;
    pub const XYZ_Z: f64 = 1.08905775075987843;
}

// =============================================================================
// D50 ILLUMINANT
// =============================================================================

/// D50 standard illuminant.
/// Derived from xy chromaticity (0.3457, 0.3585).
pub mod d50 {
    pub const X: f64 = 0.3457;
    pub const Y: f64 = 0.3585;
    pub const XYZ_X: f64 = 0.96429567642956771;
    pub const XYZ_Y: f64 = 1.0;
    pub const XYZ_Z: f64 = 0.82510460251046025;
}

// =============================================================================
// sRGB / Rec.709 MATRICES
// =============================================================================

/// Linear sRGB → XYZ matrix.
/// These 4-digit coefficients are canonical per IEC 61966-2-1.
/// Row-major: result[row] = dot(matrix[row], rgb)
pub const SRGB_TO_XYZ: [[f64; 3]; 3] = [
    [0.4124, 0.3576, 0.1805],
    [0.2126, 0.7152, 0.0722],
    [0.0193, 0.1192, 0.9505],
];

/// XYZ → Linear sRGB matrix (derived inverse).
pub const XYZ_TO_SRGB: [[f64; 3]; 3] = [
    [3.24062547732005291, -1.53720797221031846, -0.49862859869824766],
    [-0.96893071472931924, 1.87575606088524105, 0.04151752384295395],
    [0.05571012044551060, -0.20402105059848666, 1.05699594225438798],
];

/// sRGB chromaticities derived from XYZ matrix columns.
/// x = X/(X+Y+Z), y = Y/(X+Y+Z) for each primary.
pub mod srgb_chromaticity {
    pub const RED_X: f64 = 0.64007449945677475;
    pub const RED_Y: f64 = 0.32997051063169336;
    pub const GREEN_X: f64 = 0.3;
    pub const GREEN_Y: f64 = 0.6;
    pub const BLUE_X: f64 = 0.15001662234042551;
    pub const BLUE_Y: f64 = 0.06000664893617021;
}

// =============================================================================
// APPLE RGB MATRICES
// =============================================================================

/// Linear Apple RGB → XYZ matrix.
pub const APPLE_RGB_TO_XYZ: [[f64; 3]; 3] = [
    [0.44966162221556277, 0.31625611826990330, 0.18453818656620571],
    [0.24461592248526617, 0.67204425132354439, 0.08333982619118969],
    [0.02518105084407150, 0.14118576708477823, 0.92269093283102854],
];

/// XYZ → Linear Apple RGB matrix.
pub const XYZ_TO_APPLE_RGB: [[f64; 3]; 3] = [
    [2.95197847969455207, -1.28960430406109050, -0.47391530718500535],
    [-1.08508357443367731, 1.99080933911131841, 0.03720167780571314],
    [0.08547221373222354, -0.26942971179950037, 1.09102766940544083],
];

// =============================================================================
// DISPLAY P3 MATRICES
// =============================================================================

/// Linear Display P3 → XYZ matrix.
pub const DISPLAY_P3_TO_XYZ: [[f64; 3]; 3] = [
    [0.48657094864821604, 0.26566769316909306, 0.19821728523436249],
    [0.22897456406974873, 0.69173852183650630, 0.07928691409374500],
    [-0.00000000000000004, 0.04511338185890263, 1.04394436890097597],
];

/// XYZ → Linear Display P3 matrix.
pub const XYZ_TO_DISPLAY_P3: [[f64; 3]; 3] = [
    [2.49349691194142631, -0.93138361791912427, -0.40271078445071695],
    [-0.82948896956157481, 1.76266406031834677, 0.02362468584194360],
    [0.03584583024378447, -0.07617238926804180, 0.95688452400768731],
];

// =============================================================================
// ADOBE RGB MATRICES
// =============================================================================

/// Linear Adobe RGB → XYZ matrix.
pub const ADOBE_RGB_TO_XYZ: [[f64; 3]; 3] = [
    [0.57666904291013055, 0.18555823790654630, 0.18822864623499466],
    [0.29734497525053605, 0.62736356625546608, 0.07529145849399786],
    [0.02703136138641234, 0.07068885253582723, 0.99133753683763859],
];

/// XYZ → Linear Adobe RGB matrix.
pub const XYZ_TO_ADOBE_RGB: [[f64; 3]; 3] = [
    [2.04158790381074695, -0.56500697427885971, -0.34473135077832967],
    [-0.96924363628087984, 1.87596750150772063, 0.04155505740717561],
    [0.01344428063203115, -0.11836239223101841, 1.01517499439120584],
];

// =============================================================================
// PROPHOTO RGB MATRICES (D50 white point)
// =============================================================================

/// Linear ProPhoto RGB → XYZ matrix.
/// Note: Uses D50 white point, not D65.
pub const PROPHOTO_RGB_TO_XYZ: [[f64; 3]; 3] = [
    [0.79776048967230262, 0.13518583717574031, 0.03134934958152480],
    [0.28807112822929337, 0.71184321781010140, 0.00008565396060526],
    [0.0, 0.0, 0.82510460251046014],
];

/// XYZ → Linear ProPhoto RGB matrix.
pub const XYZ_TO_PROPHOTO_RGB: [[f64; 3]; 3] = [
    [1.34579897310282814, -0.25558010007997539, -0.05110628506753401],
    [-0.54462249390283457, 1.50823274131327811, 0.02053603239147972],
    [0.0, 0.0, 1.21196754563894538],
];

// =============================================================================
// REC.2020 MATRICES
// =============================================================================

/// Linear Rec.2020 → XYZ matrix.
pub const REC2020_TO_XYZ: [[f64; 3]; 3] = [
    [0.63695804830129110, 0.14461690358620835, 0.16888097516417208],
    [0.26270021201126698, 0.67799807151887093, 0.05930171646986195],
    [0.00000000000000005, 0.02807269304908743, 1.06098505771079088],
];

/// XYZ → Linear Rec.2020 matrix.
pub const XYZ_TO_REC2020: [[f64; 3]; 3] = [
    [1.71665118797126826, -0.35567078377639255, -0.25336628137365985],
    [-0.66668435183248920, 1.61648123663493926, 0.01576854581391114],
    [0.01763985744531079, -0.04277061325780853, 0.94210312123547391],
];

// =============================================================================
// BRADFORD CHROMATIC ADAPTATION MATRICES
// =============================================================================

// Derived from the Bradford matrix using von Kries adaptation.
// All adaptations use D65_SRGB (from sRGB matrix) as the canonical working white.

/// Bradford matrix: XYZ → LMS (cone-like response).
/// Primary constant from Lam (1985) and Hunt (1994).
pub const BRADFORD: [[f64; 3]; 3] = [
    [0.8951, 0.2664, -0.1614],
    [-0.7502, 1.7135, 0.0367],
    [0.0389, -0.0685, 1.0296],
];

/// Bradford inverse: LMS → XYZ.
pub const BRADFORD_INV: [[f64; 3]; 3] = [
    [0.98699290546671226, -0.14705425642099013, 0.15996265166373125],
    [0.43230526972339456, 0.51836027153677755, 0.04929122821285560],
    [-0.00852866457517733, 0.04004282165408487, 0.96848669578755020],
];

/// Chromatic adaptation: D50 → D65_SRGB (for ProPhoto RGB).
pub const ADAPT_D50_TO_D65_SRGB: [[f64; 3]; 3] = [
    [0.95551242240366574, -0.02307612332492323, 0.06324001280269687],
    [-0.02833749505665552, 1.00997064734631725, 0.02103378961268144],
    [0.01231201918692697, -0.02050544614419757, 1.33029559638192785],
];

/// Chromatic adaptation: D65_SRGB → D50.
pub const ADAPT_D65_SRGB_TO_D50: [[f64; 3]; 3] = [
    [1.04788525794557241, 0.02292366075209749, -0.05017715518805896],
    [0.02959377104437850, 0.99045743465853320, -0.01706732234730476],
    [-0.00924211878668789, 0.01505495101086261, 0.75191394435844328],
];

/// Chromatic adaptation: D65 (4-digit) → D65_SRGB.
/// Corrects the micro white point difference between spec D65 and sRGB's implied D65.
pub const ADAPT_D65_TO_D65_SRGB: [[f64; 3]; 3] = [
    [1.00004170960581384, 0.00002272344069876, -0.00001679767158203],
    [0.00003309571464653, 0.99997611004084141, -0.00000694734414387],
    [-0.00000137599356359, 0.00000107745619636, 0.99994718333826060],
];

/// Chromatic adaptation: D65_SRGB → D65 (4-digit).
pub const ADAPT_D65_SRGB_TO_D65: [[f64; 3]; 3] = [
    [0.99995829290892180, -0.00002272305392180, 0.00001679770033361],
    [-0.00003309511540149, 1.00002389127446967, 0.00000694732113818],
    [0.00000137604451153, -0.00000107757011862, 1.00005281946711588],
];

// =============================================================================
// DIRECT RGB ↔ sRGB MATRICES
// =============================================================================

// These matrices convert directly between linear RGB spaces.
// All include appropriate chromatic adaptation to D65_SRGB:
// - D65 spaces: micro-adaptation from D65(4-digit) to D65_SRGB
// - D50 spaces (ProPhoto): full Bradford adaptation

/// Linear Apple RGB → Linear sRGB matrix.
pub const APPLE_RGB_TO_SRGB: [[f64; 3]; 3] = [
    [1.06866800768567560, -0.07850518580745343, 0.00983717812177803],
    [0.02418770358509599, 0.95998459455473495, 0.01582770186016961],
    [0.00175791570835696, 0.02973549234181458, 0.96850659194982813],
];

/// Linear sRGB → Linear Apple RGB matrix.
pub const SRGB_TO_APPLE_RGB: [[f64; 3]; 3] = [
    [0.93402564115577480, 0.07671501783331743, -0.01074065898909171],
    [-0.02351759668185015, 1.04027936683071820, -0.01676177014886859],
    [-0.00097328303018275, -0.03207833373452976, 1.03305161676471324],
];

/// Linear Display P3 → Linear sRGB matrix.
pub const DISPLAY_P3_TO_SRGB: [[f64; 3]; 3] = [
    [1.22487918147601849, -0.22481353822954864, -0.00006564324647040],
    [-0.04195788849924174, 1.04195172374747869, 0.00000616475176327],
    [-0.01960990079096084, -0.07864320389402985, 1.09825310468499060],
];

/// Linear sRGB → Linear Display P3 matrix.
pub const SRGB_TO_DISPLAY_P3: [[f64; 3]; 3] = [
    [0.82248683498237751, 0.17746500063900553, 0.00004816437861738],
    [0.03312025401163926, 0.96688319371262410, -0.00000344772426305],
    [0.01705760543286468, 0.07240486083038170, 0.91053753373675406],
];

/// Linear Adobe RGB → Linear sRGB matrix.
pub const ADOBE_RGB_TO_SRGB: [[f64; 3]; 3] = [
    [1.39828990431349931, -0.39822756898586664, -0.00006233532763278],
    [0.00010919821975480, 0.99988494768494085, 0.00000585409530456],
    [0.00003098262218937, -0.04294050927531071, 1.04290952665312098],
];

/// Linear sRGB → Linear Adobe RGB matrix.
pub const SRGB_TO_ADOBE_RGB: [[f64; 3]; 3] = [
    [0.71513703532068129, 0.28482181928153760, 0.00004114539778144],
    [-0.00007810053358852, 1.00008371890572478, -0.00000561837213640],
    [-0.00002446089196998, 0.04116874818348557, 0.95885571270848513],
];

/// Linear Rec.2020 → Linear sRGB matrix.
pub const REC2020_TO_SRGB: [[f64; 3]; 3] = [
    [1.66040059644209825, -0.58748640510092942, -0.07291419134116917],
    [-0.12441048260626411, 1.13275861563796432, -0.00834813303170007],
    [-0.01811319872369204, -0.10059400052724685, 1.11870719925093876],
];

/// Linear sRGB → Linear Rec.2020 matrix.
pub const SRGB_TO_REC2020: [[f64; 3]; 3] = [
    [0.62740676525555883, 0.32924370839776695, 0.04334952634667430],
    [0.06902847498299299, 0.91961003352170345, 0.01136149149530356],
    [0.01636549213302259, 0.08802205705086344, 0.89561245081611418],
];

/// Linear ProPhoto RGB → Linear sRGB matrix (includes D50→D65 adaptation).
pub const PROPHOTO_RGB_TO_SRGB: [[f64; 3]; 3] = [
    [2.03424781877353267, -0.72745943707744298, -0.30678838169608968],
    [-0.22864882795139582, 1.23159261245371998, -0.00294378450232358],
    [-0.00851239048996228, -0.15328577003019209, 1.16179816052015417],
];

/// Linear sRGB → Linear ProPhoto RGB matrix (includes D65→D50 adaptation).
pub const SRGB_TO_PROPHOTO_RGB: [[f64; 3]; 3] = [
    [0.52927643147516379, 0.33012455487388698, 0.14059901365094934],
    [0.09830201212380550, 0.87352666639194509, 0.02817132148424924],
    [0.01684776921750480, 0.11767048827138853, 0.86548174251110710],
];

// =============================================================================
// CIELAB DERIVED CONSTANTS
// =============================================================================

/// CIELAB constants derived from δ = 6/29.
pub mod cielab {
    /// δ = 6/29
    pub const DELTA: f64 = 0.20689655172413793;

    /// ε = δ³ = (6/29)³ ≈ 0.008856
    /// Threshold for f(t): if t > EPSILON, use cube root.
    pub const EPSILON: f64 = 0.00885645167903563;

    /// κ = (29/6)² / 3 ≈ 7.787
    /// Linear segment slope: f(t) = κ*t + 16/116 for t ≤ ε
    pub const KAPPA: f64 = 7.78703703703703631;

    /// Linear segment offset = 16/116 = 4/29
    pub const OFFSET: f64 = 0.13793103448275862;

    /// Threshold in f-space for inverse: f(ε) = δ = 6/29
    /// If f > F_THRESHOLD, use cube; otherwise use linear inverse.
    pub const F_THRESHOLD: f64 = 0.20689655172413793;
}

// =============================================================================
// TRANSFER FUNCTION DERIVED CONSTANTS
// =============================================================================

/// sRGB decode threshold in encoded space.
/// sRGB specification threshold (0.0031308) * linear_slope (12.92)
pub const SRGB_DECODE_THRESHOLD: f64 = 0.040449936;

/// Adobe RGB gamma: 563/256
pub const ADOBE_RGB_GAMMA: f64 = 2.19921875;

/// ProPhoto RGB linear segment threshold: 1/512
pub const PROPHOTO_THRESHOLD: f64 = 0.001953125;

/// ProPhoto RGB decode threshold in encoded space: 16 * (1/512)
pub const PROPHOTO_DECODE_THRESHOLD: f64 = 0.03125;

// =============================================================================
// Y'CbCr BT.709 DERIVED CONSTANTS
// =============================================================================

/// Cb channel scaling factor: 2(1-Kb)
pub const YCBCR_CB_SCALE: f64 = 1.8556;

/// Cr channel scaling factor: 2(1-Kr)
pub const YCBCR_CR_SCALE: f64 = 1.5748;

/// RGB' → Y'CbCr matrix (BT.709).
/// Y' = Kr*R' + Kg*G' + Kb*B'
/// Cb = 0.5*(B'-Y')/(1-Kb)
/// Cr = 0.5*(R'-Y')/(1-Kr)
pub const RGB_TO_YCBCR: [[f64; 3]; 3] = [
    [0.2126, 0.7152, 0.0722],
    [-0.11457210605733996, -0.38542789394266003, 0.5],
    [0.5, -0.45415290830581656, -0.04584709169418339],
];

/// Y'CbCr → RGB' matrix (BT.709).
pub const YCBCR_TO_RGB: [[f64; 3]; 3] = [
    [1.0, 0.0, 1.5748],
    [1.0, -0.18732427293064879, -0.46812427293064884],
    [1.0, 1.8556, 0.0],
];

// =============================================================================
// f32 VERSIONS FOR RUNTIME USE
// =============================================================================

/// f32 module for runtime use. All values derived from f64 constants.
pub mod f32 {

    // -------------------------------------------------------------------------
    // ILLUMINANT XYZ
    // -------------------------------------------------------------------------

    /// D65 XYZ (4-digit variant, from specs)
    pub const D65_X: f32 = 0.95045592705167159 as f32;
    pub const D65_Y: f32 = 1.0 as f32;
    pub const D65_Z: f32 = 1.08905775075987843 as f32;
    pub const D65_XYZ: [f32; 3] = [D65_X, D65_Y, D65_Z];

    /// D65 sRGB XYZ (derived from sRGB matrix row sums)
    pub const D65_SRGB_X: f32 = 0.9505 as f32;
    pub const D65_SRGB_Y: f32 = 1.0 as f32;
    pub const D65_SRGB_Z: f32 = 1.089 as f32;
    pub const D65_SRGB_XYZ: [f32; 3] = [D65_SRGB_X, D65_SRGB_Y, D65_SRGB_Z];

    pub const D50_X: f32 = 0.96429567642956771 as f32;
    pub const D50_Y: f32 = 1.0 as f32;
    pub const D50_Z: f32 = 0.82510460251046025 as f32;
    pub const D50_XYZ: [f32; 3] = [D50_X, D50_Y, D50_Z];

    // -------------------------------------------------------------------------
    // ILLUMINANT CHROMATICITY
    // -------------------------------------------------------------------------

    /// D65 chromaticity (4-digit variant)
    pub const D65_CHROMATICITY: [f32; 2] = [0.3127 as f32, 0.329 as f32];
    pub const D50_CHROMATICITY: [f32; 2] = [0.3457 as f32, 0.3585 as f32];

    // -------------------------------------------------------------------------
    // RGB <-> XYZ MATRICES
    // -------------------------------------------------------------------------

    pub const SRGB_TO_XYZ: [[f32; 3]; 3] = [
        [0.4124 as f32, 0.3576 as f32, 0.1805 as f32],
        [0.2126 as f32, 0.7152 as f32, 0.0722 as f32],
        [0.0193 as f32, 0.1192 as f32, 0.9505 as f32],
    ];
    pub const XYZ_TO_SRGB: [[f32; 3]; 3] = [
        [3.24062547732005291 as f32, -1.53720797221031846 as f32, -0.49862859869824766 as f32],
        [-0.96893071472931924 as f32, 1.87575606088524105 as f32, 0.04151752384295395 as f32],
        [0.05571012044551060 as f32, -0.20402105059848666 as f32, 1.05699594225438798 as f32],
    ];

    /// sRGB chromaticities (derived from XYZ matrix)
    pub const SRGB_RED_XY: [f32; 2] = [0.64007449945677475 as f32, 0.32997051063169336 as f32];
    pub const SRGB_GREEN_XY: [f32; 2] = [0.3 as f32, 0.6 as f32];
    pub const SRGB_BLUE_XY: [f32; 2] = [0.15001662234042551 as f32, 0.06000664893617021 as f32];

    pub const APPLE_RGB_TO_XYZ: [[f32; 3]; 3] = [
        [0.44966162221556277 as f32, 0.31625611826990330 as f32, 0.18453818656620571 as f32],
        [0.24461592248526617 as f32, 0.67204425132354439 as f32, 0.08333982619118969 as f32],
        [0.02518105084407150 as f32, 0.14118576708477823 as f32, 0.92269093283102854 as f32],
    ];
    pub const XYZ_TO_APPLE_RGB: [[f32; 3]; 3] = [
        [2.95197847969455207 as f32, -1.28960430406109050 as f32, -0.47391530718500535 as f32],
        [-1.08508357443367731 as f32, 1.99080933911131841 as f32, 0.03720167780571314 as f32],
        [0.08547221373222354 as f32, -0.26942971179950037 as f32, 1.09102766940544083 as f32],
    ];

    pub const DISPLAY_P3_TO_XYZ: [[f32; 3]; 3] = [
        [0.48657094864821604 as f32, 0.26566769316909306 as f32, 0.19821728523436249 as f32],
        [0.22897456406974873 as f32, 0.69173852183650630 as f32, 0.07928691409374500 as f32],
        [-0.00000000000000004 as f32, 0.04511338185890263 as f32, 1.04394436890097597 as f32],
    ];
    pub const XYZ_TO_DISPLAY_P3: [[f32; 3]; 3] = [
        [2.49349691194142631 as f32, -0.93138361791912427 as f32, -0.40271078445071695 as f32],
        [-0.82948896956157481 as f32, 1.76266406031834677 as f32, 0.02362468584194360 as f32],
        [0.03584583024378447 as f32, -0.07617238926804180 as f32, 0.95688452400768731 as f32],
    ];

    pub const ADOBE_RGB_TO_XYZ: [[f32; 3]; 3] = [
        [0.57666904291013055 as f32, 0.18555823790654630 as f32, 0.18822864623499466 as f32],
        [0.29734497525053605 as f32, 0.62736356625546608 as f32, 0.07529145849399786 as f32],
        [0.02703136138641234 as f32, 0.07068885253582723 as f32, 0.99133753683763859 as f32],
    ];
    pub const XYZ_TO_ADOBE_RGB: [[f32; 3]; 3] = [
        [2.04158790381074695 as f32, -0.56500697427885971 as f32, -0.34473135077832967 as f32],
        [-0.96924363628087984 as f32, 1.87596750150772063 as f32, 0.04155505740717561 as f32],
        [0.01344428063203115 as f32, -0.11836239223101841 as f32, 1.01517499439120584 as f32],
    ];

    pub const PROPHOTO_RGB_TO_XYZ: [[f32; 3]; 3] = [
        [0.79776048967230262 as f32, 0.13518583717574031 as f32, 0.03134934958152480 as f32],
        [0.28807112822929337 as f32, 0.71184321781010140 as f32, 0.00008565396060526 as f32],
        [0.0 as f32, 0.0 as f32, 0.82510460251046014 as f32],
    ];
    pub const XYZ_TO_PROPHOTO_RGB: [[f32; 3]; 3] = [
        [1.34579897310282814 as f32, -0.25558010007997539 as f32, -0.05110628506753401 as f32],
        [-0.54462249390283457 as f32, 1.50823274131327811 as f32, 0.02053603239147972 as f32],
        [0.0 as f32, 0.0 as f32, 1.21196754563894538 as f32],
    ];

    pub const REC2020_TO_XYZ: [[f32; 3]; 3] = [
        [0.63695804830129110 as f32, 0.14461690358620835 as f32, 0.16888097516417208 as f32],
        [0.26270021201126698 as f32, 0.67799807151887093 as f32, 0.05930171646986195 as f32],
        [0.00000000000000005 as f32, 0.02807269304908743 as f32, 1.06098505771079088 as f32],
    ];
    pub const XYZ_TO_REC2020: [[f32; 3]; 3] = [
        [1.71665118797126826 as f32, -0.35567078377639255 as f32, -0.25336628137365985 as f32],
        [-0.66668435183248920 as f32, 1.61648123663493926 as f32, 0.01576854581391114 as f32],
        [0.01763985744531079 as f32, -0.04277061325780853 as f32, 0.94210312123547391 as f32],
    ];

    // -------------------------------------------------------------------------
    // CHROMATIC ADAPTATION MATRICES
    // -------------------------------------------------------------------------

    pub const BRADFORD: [[f32; 3]; 3] = [
        [0.8951 as f32, 0.2664 as f32, -0.1614 as f32],
        [-0.7502 as f32, 1.7135 as f32, 0.0367 as f32],
        [0.0389 as f32, -0.0685 as f32, 1.0296 as f32],
    ];
    pub const BRADFORD_INV: [[f32; 3]; 3] = [
        [0.98699290546671226 as f32, -0.14705425642099013 as f32, 0.15996265166373125 as f32],
        [0.43230526972339456 as f32, 0.51836027153677755 as f32, 0.04929122821285560 as f32],
        [-0.00852866457517733 as f32, 0.04004282165408487 as f32, 0.96848669578755020 as f32],
    ];

    pub const ADAPT_D50_TO_D65_SRGB: [[f32; 3]; 3] = [
        [0.95551242240366574 as f32, -0.02307612332492323 as f32, 0.06324001280269687 as f32],
        [-0.02833749505665552 as f32, 1.00997064734631725 as f32, 0.02103378961268144 as f32],
        [0.01231201918692697 as f32, -0.02050544614419757 as f32, 1.33029559638192785 as f32],
    ];
    pub const ADAPT_D65_SRGB_TO_D50: [[f32; 3]; 3] = [
        [1.04788525794557241 as f32, 0.02292366075209749 as f32, -0.05017715518805896 as f32],
        [0.02959377104437850 as f32, 0.99045743465853320 as f32, -0.01706732234730476 as f32],
        [-0.00924211878668789 as f32, 0.01505495101086261 as f32, 0.75191394435844328 as f32],
    ];

    pub const ADAPT_D65_TO_D65_SRGB: [[f32; 3]; 3] = [
        [1.00004170960581384 as f32, 0.00002272344069876 as f32, -0.00001679767158203 as f32],
        [0.00003309571464653 as f32, 0.99997611004084141 as f32, -0.00000694734414387 as f32],
        [-0.00000137599356359 as f32, 0.00000107745619636 as f32, 0.99994718333826060 as f32],
    ];
    pub const ADAPT_D65_SRGB_TO_D65: [[f32; 3]; 3] = [
        [0.99995829290892180 as f32, -0.00002272305392180 as f32, 0.00001679770033361 as f32],
        [-0.00003309511540149 as f32, 1.00002389127446967 as f32, 0.00000694732113818 as f32],
        [0.00000137604451153 as f32, -0.00000107757011862 as f32, 1.00005281946711588 as f32],
    ];

    // -------------------------------------------------------------------------
    // DIRECT RGB <-> sRGB MATRICES
    // -------------------------------------------------------------------------

    pub const APPLE_RGB_TO_SRGB: [[f32; 3]; 3] = [
        [1.06866800768567560 as f32, -0.07850518580745343 as f32, 0.00983717812177803 as f32],
        [0.02418770358509599 as f32, 0.95998459455473495 as f32, 0.01582770186016961 as f32],
        [0.00175791570835696 as f32, 0.02973549234181458 as f32, 0.96850659194982813 as f32],
    ];
    pub const SRGB_TO_APPLE_RGB: [[f32; 3]; 3] = [
        [0.93402564115577480 as f32, 0.07671501783331743 as f32, -0.01074065898909171 as f32],
        [-0.02351759668185015 as f32, 1.04027936683071820 as f32, -0.01676177014886859 as f32],
        [-0.00097328303018275 as f32, -0.03207833373452976 as f32, 1.03305161676471324 as f32],
    ];

    pub const DISPLAY_P3_TO_SRGB: [[f32; 3]; 3] = [
        [1.22487918147601849 as f32, -0.22481353822954864 as f32, -0.00006564324647040 as f32],
        [-0.04195788849924174 as f32, 1.04195172374747869 as f32, 0.00000616475176327 as f32],
        [-0.01960990079096084 as f32, -0.07864320389402985 as f32, 1.09825310468499060 as f32],
    ];
    pub const SRGB_TO_DISPLAY_P3: [[f32; 3]; 3] = [
        [0.82248683498237751 as f32, 0.17746500063900553 as f32, 0.00004816437861738 as f32],
        [0.03312025401163926 as f32, 0.96688319371262410 as f32, -0.00000344772426305 as f32],
        [0.01705760543286468 as f32, 0.07240486083038170 as f32, 0.91053753373675406 as f32],
    ];

    pub const ADOBE_RGB_TO_SRGB: [[f32; 3]; 3] = [
        [1.39828990431349931 as f32, -0.39822756898586664 as f32, -0.00006233532763278 as f32],
        [0.00010919821975480 as f32, 0.99988494768494085 as f32, 0.00000585409530456 as f32],
        [0.00003098262218937 as f32, -0.04294050927531071 as f32, 1.04290952665312098 as f32],
    ];
    pub const SRGB_TO_ADOBE_RGB: [[f32; 3]; 3] = [
        [0.71513703532068129 as f32, 0.28482181928153760 as f32, 0.00004114539778144 as f32],
        [-0.00007810053358852 as f32, 1.00008371890572478 as f32, -0.00000561837213640 as f32],
        [-0.00002446089196998 as f32, 0.04116874818348557 as f32, 0.95885571270848513 as f32],
    ];

    pub const REC2020_TO_SRGB: [[f32; 3]; 3] = [
        [1.66040059644209825 as f32, -0.58748640510092942 as f32, -0.07291419134116917 as f32],
        [-0.12441048260626411 as f32, 1.13275861563796432 as f32, -0.00834813303170007 as f32],
        [-0.01811319872369204 as f32, -0.10059400052724685 as f32, 1.11870719925093876 as f32],
    ];
    pub const SRGB_TO_REC2020: [[f32; 3]; 3] = [
        [0.62740676525555883 as f32, 0.32924370839776695 as f32, 0.04334952634667430 as f32],
        [0.06902847498299299 as f32, 0.91961003352170345 as f32, 0.01136149149530356 as f32],
        [0.01636549213302259 as f32, 0.08802205705086344 as f32, 0.89561245081611418 as f32],
    ];

    pub const PROPHOTO_RGB_TO_SRGB: [[f32; 3]; 3] = [
        [2.03424781877353267 as f32, -0.72745943707744298 as f32, -0.30678838169608968 as f32],
        [-0.22864882795139582 as f32, 1.23159261245371998 as f32, -0.00294378450232358 as f32],
        [-0.00851239048996228 as f32, -0.15328577003019209 as f32, 1.16179816052015417 as f32],
    ];
    pub const SRGB_TO_PROPHOTO_RGB: [[f32; 3]; 3] = [
        [0.52927643147516379 as f32, 0.33012455487388698 as f32, 0.14059901365094934 as f32],
        [0.09830201212380550 as f32, 0.87352666639194509 as f32, 0.02817132148424924 as f32],
        [0.01684776921750480 as f32, 0.11767048827138853 as f32, 0.86548174251110710 as f32],
    ];

    // -------------------------------------------------------------------------
    // TRANSFER FUNCTION CONSTANTS
    // -------------------------------------------------------------------------

    /// sRGB encode threshold (linear space)
    pub const SRGB_THRESHOLD: f32 = 0.0031308 as f32;
    /// sRGB decode threshold (encoded space)
    pub const SRGB_DECODE_THRESHOLD: f32 = 0.040449936 as f32;
    pub const SRGB_LINEAR_SLOPE: f32 = 12.92 as f32;
    pub const SRGB_GAMMA: f32 = 2.4;
    pub const SRGB_SCALE: f32 = 1.055;
    pub const SRGB_OFFSET: f32 = 0.055;

    pub const ADOBE_RGB_GAMMA: f32 = 2.19921875 as f32;
    pub const APPLE_RGB_GAMMA: f32 = 1.8 as f32;

    pub const PROPHOTO_THRESHOLD: f32 = 0.001953125 as f32;
    pub const PROPHOTO_DECODE_THRESHOLD: f32 = 0.03125 as f32;
    pub const PROPHOTO_LINEAR_MULTIPLIER: f32 = 16.0 as f32;
    pub const PROPHOTO_GAMMA: f32 = 1.8 as f32;

    pub const GAMMA_22: f32 = 2.2;

    // -------------------------------------------------------------------------
    // CIELAB CONSTANTS
    // -------------------------------------------------------------------------

    pub const CIELAB_DELTA: f32 = 0.20689655172413793 as f32;
    pub const CIELAB_EPSILON: f32 = 0.00885645167903563 as f32;
    pub const CIELAB_KAPPA: f32 = 7.78703703703703631 as f32;
    pub const CIELAB_OFFSET: f32 = 0.13793103448275862 as f32;
    pub const CIELAB_F_THRESHOLD: f32 = 0.20689655172413793 as f32;
    /// Negative threshold: where linear segment meets cbrt for t < 0
    pub const CIELAB_NEG_EPSILON: f32 = 0.07085161343228505 as f32;
    /// f(-NEG_EPSILON) threshold in f-space for inverse
    pub const CIELAB_NEG_F_THRESHOLD: f32 = -0.41379310344827586 as f32;
    pub const CIELAB_L_SCALE: f32 = 116.0;
    pub const CIELAB_L_OFFSET: f32 = 16.0;
    pub const CIELAB_A_SCALE: f32 = 500.0;
    pub const CIELAB_B_SCALE: f32 = 200.0;

    // -------------------------------------------------------------------------
    // OKLAB MATRICES (from primary constants)
    // -------------------------------------------------------------------------

    /// OKLab M1: Linear sRGB → LMS
    pub const OKLAB_M1: [[f32; 3]; 3] = [
        [0.4122214708 as f32, 0.5363325363 as f32, 0.0514459929 as f32],
        [0.2119034982 as f32, 0.6806995451 as f32, 0.1073969566 as f32],
        [0.0883024619 as f32, 0.2817188376 as f32, 0.6299787005 as f32],
    ];

    /// OKLab M2: LMS' → Lab
    pub const OKLAB_M2: [[f32; 3]; 3] = [
        [0.2104542553 as f32, 0.793617785 as f32, -0.0040720468 as f32],
        [1.9779984951 as f32, -2.428592205 as f32, 0.4505937099 as f32],
        [0.0259040371 as f32, 0.7827717662 as f32, -0.808675766 as f32],
    ];

    /// OKLab M1_inv: LMS → Linear sRGB
    pub const OKLAB_M1_INV: [[f32; 3]; 3] = [
        [4.0767416621 as f32, -3.3077115913 as f32, 0.2309699292 as f32],
        [-1.2684380046 as f32, 2.6097574011 as f32, -0.3413193965 as f32],
        [-0.0041960863 as f32, -0.7034186147 as f32, 1.707614701 as f32],
    ];

    /// OKLab M2_inv: Lab → LMS'
    pub const OKLAB_M2_INV: [[f32; 3]; 3] = [
        [1.0 as f32, 0.3963377774 as f32, 0.2158037573 as f32],
        [1.0 as f32, -0.1055613458 as f32, -0.0638541728 as f32],
        [1.0 as f32, -0.0894841775 as f32, -1.291485548 as f32],
    ];

    // -------------------------------------------------------------------------
    // Y'CbCr CONSTANTS
    // -------------------------------------------------------------------------

    /// BT.709 luma coefficients
    pub const YCBCR_KR: f32 = 0.2126 as f32;
    pub const YCBCR_KG: f32 = 0.7152 as f32;
    pub const YCBCR_KB: f32 = 0.0722 as f32;
    pub const YCBCR_CB_SCALE: f32 = 1.8556 as f32;
    pub const YCBCR_CR_SCALE: f32 = 1.5748 as f32;

    pub const RGB_TO_YCBCR: [[f32; 3]; 3] = [
        [0.2126 as f32, 0.7152 as f32, 0.0722 as f32],
        [-0.11457210605733996 as f32, -0.38542789394266003 as f32, 0.5 as f32],
        [0.5 as f32, -0.45415290830581656 as f32, -0.04584709169418339 as f32],
    ];
    pub const YCBCR_TO_RGB: [[f32; 3]; 3] = [
        [1.0 as f32, 0.0 as f32, 1.5748 as f32],
        [1.0 as f32, -0.18732427293064879 as f32, -0.46812427293064884 as f32],
        [1.0 as f32, 1.8556 as f32, 0.0 as f32],
    ];

    /// BT.601 luma coefficients
    pub const YCBCR_601_KR: f32 = 0.299;
    pub const YCBCR_601_KG: f32 = 0.587;
    pub const YCBCR_601_KB: f32 = 0.114;

    // -------------------------------------------------------------------------
    // BIT DEPTH
    // -------------------------------------------------------------------------

    pub const UINT8_MAX: f32 = 255.0;
    pub const UINT16_MAX: f32 = 65535.0;
}

// =============================================================================
// TESTS
// =============================================================================

#[cfg(test)]
mod tests {
    use super::*;

    fn mat_mul(a: [[f64; 3]; 3], b: [[f64; 3]; 3]) -> [[f64; 3]; 3] {
        let mut r = [[0.0; 3]; 3];
        for i in 0..3 {
            for j in 0..3 {
                for k in 0..3 {
                    r[i][j] += a[i][k] * b[k][j];
                }
            }
        }
        r
    }

    fn is_identity(m: [[f64; 3]; 3], tol: f64) -> bool {
        for i in 0..3 {
            for j in 0..3 {
                let expected = if i == j { 1.0 } else { 0.0 };
                if (m[i][j] - expected).abs() > tol {
                    return false;
                }
            }
        }
        true
    }

    #[test]
    fn test_srgb_matrices_are_inverses() {
        let product = mat_mul(SRGB_TO_XYZ, XYZ_TO_SRGB);
        assert!(is_identity(product, 1e-10), "SRGB matrices not inverse");
    }

    #[test]
    fn test_apple_matrices_are_inverses() {
        let product = mat_mul(APPLE_RGB_TO_XYZ, XYZ_TO_APPLE_RGB);
        assert!(is_identity(product, 1e-10), "Apple RGB matrices not inverse");
    }

    #[test]
    fn test_p3_matrices_are_inverses() {
        let product = mat_mul(DISPLAY_P3_TO_XYZ, XYZ_TO_DISPLAY_P3);
        assert!(is_identity(product, 1e-10), "Display P3 matrices not inverse");
    }

    #[test]
    fn test_adobe_matrices_are_inverses() {
        let product = mat_mul(ADOBE_RGB_TO_XYZ, XYZ_TO_ADOBE_RGB);
        assert!(is_identity(product, 1e-10), "Adobe RGB matrices not inverse");
    }

    #[test]
    fn test_prophoto_matrices_are_inverses() {
        let product = mat_mul(PROPHOTO_RGB_TO_XYZ, XYZ_TO_PROPHOTO_RGB);
        assert!(is_identity(product, 1e-10), "ProPhoto RGB matrices not inverse");
    }

    #[test]
    fn test_rec2020_matrices_are_inverses() {
        let product = mat_mul(REC2020_TO_XYZ, XYZ_TO_REC2020);
        assert!(is_identity(product, 1e-10), "Rec.2020 matrices not inverse");
    }

    #[test]
    fn test_ycbcr_matrices_are_inverses() {
        let product = mat_mul(RGB_TO_YCBCR, YCBCR_TO_RGB);
        assert!(is_identity(product, 1e-10), "Y'CbCr matrices not inverse");
    }

    #[test]
    fn test_cielab_epsilon() {
        let expected = (6.0_f64 / 29.0).powi(3);
        assert!((cielab::EPSILON - expected).abs() < 1e-15);
    }

    #[test]
    fn test_cielab_kappa() {
        let expected = (29.0_f64 / 6.0).powi(2) / 3.0;
        assert!((cielab::KAPPA - expected).abs() < 1e-12);
    }

    #[test]
    fn test_srgb_white_matches_d65_srgb() {
        // RGB (1,1,1) maps to white XYZ via matrix row sums.
        // This should exactly match d65_srgb since both are derived from the same matrix.
        let x = SRGB_TO_XYZ[0][0] + SRGB_TO_XYZ[0][1] + SRGB_TO_XYZ[0][2];
        let y = SRGB_TO_XYZ[1][0] + SRGB_TO_XYZ[1][1] + SRGB_TO_XYZ[1][2];
        let z = SRGB_TO_XYZ[2][0] + SRGB_TO_XYZ[2][1] + SRGB_TO_XYZ[2][2];
        assert!((x - d65_srgb::XYZ_X).abs() < 1e-14, "X: {} vs {}", x, d65_srgb::XYZ_X);
        assert!((y - d65_srgb::XYZ_Y).abs() < 1e-14, "Y: {} vs {}", y, d65_srgb::XYZ_Y);
        assert!((z - d65_srgb::XYZ_Z).abs() < 1e-14, "Z: {} vs {}", z, d65_srgb::XYZ_Z);
    }

    #[test]
    fn test_apple_direct_matrices_are_inverses() {
        let product = mat_mul(APPLE_RGB_TO_SRGB, SRGB_TO_APPLE_RGB);
        assert!(is_identity(product, 1e-10), "Apple RGB direct matrices not inverse");
    }

    #[test]
    fn test_p3_direct_matrices_are_inverses() {
        let product = mat_mul(DISPLAY_P3_TO_SRGB, SRGB_TO_DISPLAY_P3);
        assert!(is_identity(product, 1e-10), "Display P3 direct matrices not inverse");
    }

    #[test]
    fn test_adobe_direct_matrices_are_inverses() {
        let product = mat_mul(ADOBE_RGB_TO_SRGB, SRGB_TO_ADOBE_RGB);
        assert!(is_identity(product, 1e-10), "Adobe RGB direct matrices not inverse");
    }

    #[test]
    fn test_rec2020_direct_matrices_are_inverses() {
        let product = mat_mul(REC2020_TO_SRGB, SRGB_TO_REC2020);
        assert!(is_identity(product, 1e-10), "Rec.2020 direct matrices not inverse");
    }

    #[test]
    fn test_prophoto_direct_matrices_are_inverses() {
        let product = mat_mul(PROPHOTO_RGB_TO_SRGB, SRGB_TO_PROPHOTO_RGB);
        assert!(is_identity(product, 1e-10), "ProPhoto RGB direct matrices not inverse");
    }

    #[test]
    fn test_bradford_matrices_are_inverses() {
        let product = mat_mul(BRADFORD, BRADFORD_INV);
        assert!(is_identity(product, 1e-10), "Bradford matrices not inverse");
    }

    #[test]
    fn test_d50_d65_adaptation_roundtrip() {
        let product = mat_mul(ADAPT_D50_TO_D65_SRGB, ADAPT_D65_SRGB_TO_D50);
        assert!(is_identity(product, 1e-10), "D50<->D65 adaptation not inverse");
    }

    #[test]
    fn test_d65_d65srgb_adaptation_roundtrip() {
        let product = mat_mul(ADAPT_D65_TO_D65_SRGB, ADAPT_D65_SRGB_TO_D65);
        assert!(is_identity(product, 1e-10), "D65<->D65_SRGB adaptation not inverse");
    }
}
